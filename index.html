<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Break the Bank</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background: black; color: white; text-align: center; }
        canvas { display: block; margin: auto; }
    </style>
</head>
<body>

<script>
const gameConfig = {
    type: Phaser.AUTO,
    width: 400,
    height: 600,
    backgroundColor: "#0d0d0d",
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

let game = new Phaser.Game(gameConfig);
let vault, clickCount = 0, clickText, rewardText, crackEffect, coinsGroup;
let vaultCracks = [
    'https://i.imgur.com/Crack1.png', // Add your own crack images
    'https://i.imgur.com/Crack2.png',
    'https://i.imgur.com/Crack3.png'
];
let vaultBroken = false;
let satoshis = 0; // Player's satoshi balance
let bitcoinPrice = 0; // Current Bitcoin price in USD
let satoshisPerDollar = 0; // Number of satoshis for $1
let maxHits = 1000000; // 1 Million Taps required to break the vault

function preload() {
    this.load.image('vault', 'https://your-vault-graphic-url.com/vault.png'); // Your vault image
    this.load.audio('hitSound', 'https://www.soundjay.com/button/beep-07.wav'); // Replace with actual hit sound URL
    this.load.audio('breakSound', 'https://www.soundjay.com/button/beep-09.wav'); // Replace with actual break sound URL
    this.load.image('coin', 'https://i.imgur.com/Dp7KME7.png'); // Replace with actual coin image URL
    vaultCracks.forEach((crack, index) => this.load.image(`crack${index}`, crack));

    // Fetch current Bitcoin price
    fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd')
        .then(response => response.json())
        .then(data => {
            bitcoinPrice = data.bitcoin.usd;
            satoshisPerDollar = Math.floor(1000000 / bitcoinPrice); // Calculate how many satoshis = $1
            console.log("Bitcoin Price:", bitcoinPrice);
            console.log("Satoshis per $1:", satoshisPerDollar);
        })
        .catch(error => console.error('Error fetching Bitcoin price:', error));
}

function create() {
    vault = this.add.image(200, 300, 'vault').setInteractive();
    vault.setScale(0.5);
    
    clickText = this.add.text(200, 50, "Hits: 0", {
        fontSize: '24px',
        fill: '#00ffcc',
        fontFamily: 'Arial'
    }).setOrigin(0.5);

    rewardText = this.add.text(200, 100, "Reward: 0 BTC", {
        fontSize: '24px',
        fill: '#ffcc00',
        fontFamily: 'Arial'
    }).setOrigin(0.5);
    
    // Sound effects
    this.hitSound = this.sound.add('hitSound');
    this.breakSound = this.sound.add('breakSound');
    
    coinsGroup = this.add.group();
    
    vault.on('pointerdown', function () {
        if (vaultBroken) return;
        
        clickCount++;
        clickText.setText("Hits: " + clickCount);
        
        // Track satoshis (1 tap = 1 satoshi)
        satoshis++;
        
        // Calculate Bitcoin reward based on satoshis
        let bitcoinReward = satoshis / satoshisPerDollar; // Reward in Bitcoin
        
        // Update the reward text
        rewardText.setText("Reward: " + bitcoinReward.toFixed(8) + " BTC");
        
        // Play hit sound
        this.hitSound.play();
        
        // Show vault crack animation
        if (clickCount <= vaultCracks.length) {
            crackEffect = this.add.image(200, 300, `crack${clickCount - 1}`).setScale(0.5);
            setTimeout(() => crackEffect.destroy(), 500);  // Remove crack effect after animation
        }

        // Intensity effect: Increase flash duration and intensity
        vault.setTint(0xff0000);
        setTimeout(() => vault.clearTint(), 100);

        // Check if vault should break
        if (clickCount >= maxHits) {
            breakVault();
        }
    }, this);
}

function breakVault() {
    if (vaultBroken) return;
    
    vaultBroken = true;
    
    // Play break sound
    this.breakSound.play();
    
    // Scatter coins
    for (let i = 0; i < 20; i++) {
        let coin = this.add.image(Phaser.Math.Between(100, 300), Phaser.Math.Between(200, 400), 'coin').setScale(0.5);
        coin.setAlpha(0);
        this.tweens.add({
            targets: coin,
            alpha: 1,
            y: coin.y - 50,
            duration: 600,
            ease: 'Power2',
            onComplete: () => {
                this.tweens.add({
                    targets: coin,
                    alpha: 0,
                    y: coin.y + 50,
                    duration: 400,
                    ease: 'Power2',
                    onComplete: () => coin.destroy()
                });
            }
        });
    }

    // Show win message
    let winText = this.add.text(200, 450, 'Vault Broken! You earned Bitcoin!', {
        fontSize: '30px',
        fill: '#FFFF00',
        fontFamily: 'Arial'
    }).setOrigin(0.5);

    // Restart game after a brief delay
    this.time.addEvent({
        delay: 3000,
        callback: () => {
            clickCount = 0;
            satoshis = 0;
            clickText.setText("Hits: 0");
            rewardText.setText("Reward: 0 BTC");
            vaultBroken = false;
            winText.destroy();
        },
        loop: false
    });
}

function update() {
    // Additional game logic can go here if needed
}
</script>

</body>
</html>
